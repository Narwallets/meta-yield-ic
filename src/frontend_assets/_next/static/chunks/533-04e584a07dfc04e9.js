"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{1533:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var r=n(4051),i=n.n(r),a=n(5893),o=n(7294),s=n(1543),u=n(3465),c=n(8527),l=n(4612),d=n(7657),h=n(5113),f=n(1163),p=n(381),m=n.n(p),x=n(2175),v=n(6733),w=n(5297),b=n(8191),g=n(4875),j=n(4231),_=j.Ry().shape({amount_deposit:j.Rx().max(j.iH("balance"),"You dont have enough stICP.")}),k=j.Ry().shape({amount_withdraw:j.Rx().required("The amount to withdraw is required").moreThan(0,"The amount to withdraw must be greater than 0")});function S(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){S(a,r,i,o,s,"next",e)}function s(e){S(a,r,i,o,s,"throw",e)}o(void 0)}))}}var E=function(e){var t=e.project,n=e.supportedDeposited,r=n>0,p=((0,f.useRouter)(),(0,w.o)().wallet,(0,b.oR)()),j=(p.loggedIn,p.principal),S=(p.actor,p.setLoggedIn,p.setPrincipal,p.setActor,(0,s.pm)()),E=(0,o.useState)(0),R=E[0],C=E[1],O=(0,o.useState)(0),z=O[0],T=O[1],I=(0,o.useState)(void 0),P=(I[0],I[1]),A=(0,o.useState)(void 0),D=(A[0],A[1]),N=(0,o.useState)(),W=N[0],q=N[1],B=(0,o.useState)(0),M=B[0],V=B[1],F=function(){var e=y(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K.setFieldValue("amount_deposit",z),C(z);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=y(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",U.setFieldValue("amount_withdraw",n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=(0,x.TA)({initialValues:{amount_deposit:0,balance:0},validationSchema:_,validateOnMount:!0,enableReinitialize:!0,validateOnBlur:!0,validateOnChange:!0,onSubmit:function(){var e=y(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.amount_deposit<1)){e.next=4;break}S({title:"Transaction error.",description:"The amount to deposit must be at least ".concat(1," stNEAR"),status:"error",duration:9e3,position:"top-right",isClosable:!0}),e.next=7;break;case 4:return e.next=6,(0,v.E0)(j,t.id,n.amount_deposit);case 6:e.sent;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),U=(0,x.TA)({initialValues:{amount_withdraw:0,supporterDeposited:0},validationSchema:k,validateOnMount:!0,enableReinitialize:!0,validateOnBlur:!0,validateOnChange:!0,onSubmit:function(){var e=y(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.amount_deposit<=0)){e.next=4;break}S({title:"Transaction error.",description:"The amount to withdraw must be greater than 0",status:"error",duration:9e3,position:"top-right",isClosable:!0}),e.next=7;break;case 4:return e.next=6,L((0,g.nq)(t.amount_withdraw));case 6:e.sent;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),L=function(){var e=y(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,v.XW)(j,t.id,n).then((function(e){console.log("Return withdraw success",e)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){if(t){var e=(0,g.eu)(t.kickstarter.goals,t.kickstarter.total_deposited);if(q(e),e){var n;P(parseInt(e.desired_amount)/Math.pow(10,24));var r=m()(e.unfreeze_timestamp).diff(m()(null===t||void 0===t||null===(n=t.kickstarter)||void 0===n?void 0:n.close_timestamp),"months");D(r)}}}),[t]),(0,o.useEffect)((function(){if(W){var e=W.tokens_to_release_per_stnear;V((0,g.qc)(e)*R)}}),[R,W]),(0,o.useEffect)((function(){K.setFieldValue("balance",z)}),[z]),(0,o.useEffect)((function(){y(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.sb)(j);case 2:t=e.sent,T(t);case 4:case"end":return e.stop()}}),e)})))()}),[j]),t?(0,a.jsxs)(u.mQ,{defaultIndex:0,children:[(0,a.jsxs)(u.td,{children:[(0,a.jsx)(u.OK,{children:"Deposit"}),(0,a.jsx)(u.OK,{isDisabled:!r,children:"Withdraw"})]}),(0,a.jsxs)(u.nP,{children:[(0,a.jsxs)(u.x4,{children:[(0,a.jsxs)(c.Ug,{children:[(0,a.jsxs)(l.BZ,{children:[(0,a.jsx)(l.Ui,{children:(0,a.jsxs)(c.bK,{minW:"30px",children:[(0,a.jsx)(d.qE,{boxSize:"30px",objectFit:"cover",src:"/stNEARorig.svg"}),(0,a.jsx)(c.xv,{ml:2,children:"stNEAR"})]})}),(0,a.jsx)(l.II,{id:"amount_deposit",name:"amount_deposit",placeholder:"0",value:K.values.amount_deposit,onPaste:K.handleChange,onBlur:K.handleBlur,onChange:function(e){C(e.target.value),K.handleChange(e)}}),(0,a.jsx)(l.xH,{width:"4.5rem",children:(0,a.jsx)(h.zx,{h:"1.75rem",size:"sm",onClick:F,children:"Max"})})]}),(0,a.jsx)(h.zx,{colorScheme:"blue",size:"lg",onClick:function(e){return K.handleSubmit(e)},children:"Deposit"})]}),!K.isValid&&(0,a.jsx)(c.Ug,{mt:5,children:(0,a.jsx)(c.xv,{dangerouslySetInnerHTML:{__html:K.errors&&K.errors.amount_deposit?K.errors.amount_deposit:""},color:"red"})}),(0,a.jsx)(c.Kq,{mt:4,children:(0,a.jsxs)(c.xv,{fontSize:"md",lineHeight:"6",fontWeight:"semibold",color:"gray.500",children:["ESTIMATED REWARDS: ",M," ",t.kickstarter.project_token_symbol]})})]}),(0,a.jsxs)(u.x4,{children:[(0,a.jsxs)(c.Ug,{children:[(0,a.jsxs)(l.BZ,{children:[(0,a.jsx)(l.Ui,{children:(0,a.jsxs)(c.bK,{minW:"30px",children:[(0,a.jsx)(d.qE,{boxSize:"30px",objectFit:"cover",src:"/stNEARorig.svg"}),(0,a.jsx)(c.xv,{ml:2,children:"stNEAR"})]})}),(0,a.jsx)(l.II,{id:"amount_withdraw",name:"amount_withdraw",placeholder:"0",value:U.values.amount_withdraw,onPaste:U.handleChange,onBlur:U.handleBlur,onChange:U.handleChange}),(0,a.jsx)(l.xH,{width:"4.5rem",children:(0,a.jsx)(h.zx,{h:"1.75rem",size:"sm",onClick:H,children:"Max"})})]}),(0,a.jsx)(h.zx,{colorScheme:"blue",size:"lg",disabled:!U.isValid,onClick:function(e){U.handleSubmit(e)},children:"Withdraw"})]}),(0,a.jsx)(c.Kq,{mt:4,children:(0,a.jsxs)(c.xv,{fontSize:"md",lineHeight:"6",fontWeight:"semibold",color:"gray.500",children:["CURRENT DEPOSITS: ",n," stNEAR"]})})]})]})]}):(0,a.jsx)(a.Fragment,{})}},5297:function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){r(e,t,n[t])}))}return e}n.d(t,{o:function(){return a}});var a=(0,n(4671).Z)((function(e){return{wallet:null,isLogin:!1,setLogin:function(t){return e((function(e){return i({},e,{isLogin:t})}))},setWallet:function(t){return e((function(e){return i({},e,{wallet:t})}))}}}))}}]);